Robot-\/assisted minimally invasive surgery (R\+M\+IS) has become increasingly popular in the resection of cancers. However, the lack of tactile feedback in clinical R\+M\+IS limits the surgeon’s haptic understanding of tissue mechanics, making it hard to detect tissue abnormalities (e.\+g., tumors) efficiently. This project will use Gaussian Processes (GP) to model the stiffness distribution and develop an active exploration strategy to autonomously guide the robot to localize the tumor profile via robot palpation using Bayesian Optimization (BO). Compared to exhaustively palpating the entire organ to achieve tumor localization, the proposed framework aims at improving efficiency with minimum times of exploration. Simulation and comparison experiments will be conducted to verify the performance of the proposed strategy.  
\begin{DoxyImage}
\includegraphics[width=\textwidth,height=\textheight/2,keepaspectratio=true]{READMEPHOTO.png}
\doxyfigcaption{Example Image}
\end{DoxyImage}
  

The localization can be run in two different modes. The first option, which offers full functionality, can be accessed by installing and compiling the source code on your local machine. If you prefer not to run the code on your host machine, you can run the code inside a Docker container. Computation results will be written to the host machine through a mount point. \hypertarget{index_autotoc_md1}{}\doxysection{1. Run on your local machine}\label{index_autotoc_md1}
\hypertarget{index_autotoc_md2}{}\doxysubsection{Installation}\label{index_autotoc_md2}
\hypertarget{index_autotoc_md3}{}\doxysubsubsection{1. Install dependencies}\label{index_autotoc_md3}
For Ubuntu/\+Debian, the minimum dependencies (C/\+C++) can be optained by running\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{sudo apt-\/get update}
\DoxyCodeLine{sudo apt install  cmake g++ build-\/essential}
\DoxyCodeLine{sudo apt install libboost-\/dev freeglut3-\/dev libcgal-\/dev libomp-\/dev libarmadillo-\/dev libensmallen-\/dev libglu1-\/mesa-\/dev freeglut3-\/dev mesa-\/common-\/dev  libstb-\/dev }
\end{DoxyCode}


Navigate to a desired install location for cereal library and run the following command\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{sudo wget https://github.com/USCiLab/cereal/archive/refs/tags/v1.1.2.tar.gz \(\backslash\)}
\DoxyCodeLine{    \&\& tar -\/xzf v1.1.2.tar.gz \(\backslash\)}
\DoxyCodeLine{    \&\& sudo mkdir -\/p /usr/local/include/cereal \(\backslash\)}
\DoxyCodeLine{    \&\& sudo cp -\/r cereal-\/1.1.2/include/cereal/* /usr/local/include/cereal/}
\DoxyCodeLine{}
\DoxyCodeLine{sudo apt install libmlpack-\/dev }
\end{DoxyCode}


The required Bayes\+Opt C++ library to perform Bayesian optimization needs to be cloned to a convenient location and build. Install required dependencies\+: N\+Lopt -\/ Library 
\begin{DoxyCode}{0}
\DoxyCodeLine{git clone https://github.com/stevengj/nlopt.git}
\DoxyCodeLine{cd nlopt}
\DoxyCodeLine{mkdir build}
\DoxyCodeLine{cd build}
\DoxyCodeLine{cmake ..}
\DoxyCodeLine{make}
\DoxyCodeLine{sudo make install}
\end{DoxyCode}


To install the Bayes\+Opt library, run\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{git clone https://github.com/rmcantin/bayesopt}
\DoxyCodeLine{cd bayesopt}
\DoxyCodeLine{cmake . }
\DoxyCodeLine{make}
\DoxyCodeLine{sudo make install}
\end{DoxyCode}
\hypertarget{index_autotoc_md4}{}\doxysubsubsection{2. Clone repository}\label{index_autotoc_md4}
Clone repository and build the package. 
\begin{DoxyCode}{0}
\DoxyCodeLine{git clone https://git.tu-\/berlin.de/raphael/bo\_robotic\_palpation}
\DoxyCodeLine{cd bo\_robotic\_palpation}
\DoxyCodeLine{mkdir build \&\& cd build}
\DoxyCodeLine{cmake ..}
\DoxyCodeLine{make}
\end{DoxyCode}
\hypertarget{index_autotoc_md5}{}\doxysubsection{Using the package}\label{index_autotoc_md5}
\hypertarget{index_autotoc_md6}{}\doxysubsubsection{1. Configure Tumor Model Parameters}\label{index_autotoc_md6}
Four different shapes are pre-\/programmed, and shape attributes can be adjusted to test the robustness of the algorithm. Inside /config/tumor\+\_\+model\+\_\+parameters.txt, you will find a set of pre-\/defined parameters for four different shapes including a \mbox{\hyperlink{classTriangle}{Triangle}}, \mbox{\hyperlink{classRectangle}{Rectangle}}, Circle, and a \mbox{\hyperlink{classTwoCircles}{Two\+Circles}} configuration. All shapes share a set of common parameters which are\+:
\begin{DoxyItemize}
\item Low and high stiffness values
\item Translation in x and y,
\item Size defined by radius,
\item Epsilon (defines how smooth values transition from high to low stiffness areas)
\item Noise to simulation measurement error (gaussian and zero mean).
\end{DoxyItemize}\hypertarget{index_autotoc_md7}{}\doxysubsubsection{2. Configure Bayesian Optimization Parameters}\label{index_autotoc_md7}
Approximation of a posterior distribution is done by iteratively probing the tumor model and updating a Gaussian process. A detailed description of parameters can be found in the documentation of the Bayes\+Opt library\+: \href{http://rmcantin.github.io/bayesopt/html/usemanual.html\#params}{\texttt{ http\+://rmcantin.\+github.\+io/bayesopt/html/usemanual.\+html\#params}} \hypertarget{index_autotoc_md8}{}\doxysubsubsection{3. Configure Contour Parameters}\label{index_autotoc_md8}
Once a posterior distribution is found the contour of the tumor is approximated. This is done by first running a means shift clustering algorithm on a sampled representation of the posterior. In a second step the computed centroids are explored in radial direction.

More precisely, the algorithm will start exploring centroids by probing a set of pre-\/defined planar directions. Each direction is explored until the tumor stiffness is changing and a threshold criterion is met. Directions are computed by defining angle segments along which the algorithm explores the centroids. Angle segments are pre-\/defined by a parameter that divides 360°. Once a set of contour points is found, a spline approximation is performed to compute the contour of the tumor.

The following parameters listed in /config/contour\+\_\+parameters.txt can be tuned to refine the tumor approximation process.
\begin{DoxyItemize}
\item n\+\_\+exploration\+\_\+directions, defines the number of directions a centroid is explored in
\item c\+\_\+points, granularity of gaussian process. Will define how many points are used in x and y directions
\item means\+\_\+shift\+\_\+bandwidth, sets the bandwidth for the means shift algorithm \href{https://github.com/mlpack/mlpack/tree/master/src/mlpack/methods/mean_shift}{\texttt{ https\+://github.\+com/mlpack/mlpack/tree/master/src/mlpack/methods/mean\+\_\+shift}}
\item lim\+\_\+steps, determines the maximum amount of samples that are taken in each direction
\item threshold\+\_\+multiplier, determines the stiffness threshold. To do so, all previously seen sample stiffnesses are clustered by a k-\/means algorithm. Given that high stiffness values correlate with tumorous tissue, the cluster with the highest values is selected and its mean value and uncertainty calculated. Based on these measures, the threshold\+\_\+multiplier parameter will define how many standard deviations from the mean value of the tumor stiffness cluster are categorized as tumor tissue.
\end{DoxyItemize}\hypertarget{index_autotoc_md9}{}\doxysubsubsection{2. Run the optimization}\label{index_autotoc_md9}
The algorithm can be executed with four different tumor models. The algorithm can be simulated with a triangle-\/, rectangle-\/, circle and two-\/circle-\/shaped tumor model of adjustable size and stiffness. To run the algorithm, run the following command inside the build directory\+:
\begin{DoxyEnumerate}
\item \mbox{\hyperlink{classTriangle}{Triangle}} experiment\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{cd build}
\DoxyCodeLine{./display\_gp Triangle}
\end{DoxyCode}

\item \mbox{\hyperlink{classRectangle}{Rectangle}} experiment\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{cd build}
\DoxyCodeLine{./display\_gp Rectangle}
\end{DoxyCode}

\item Cricle experiment 
\begin{DoxyCode}{0}
\DoxyCodeLine{cd build}
\DoxyCodeLine{./display\_gp Cricle}
\end{DoxyCode}

\item Two-\/\+Cricles experiment 
\begin{DoxyCode}{0}
\DoxyCodeLine{cd build}
\DoxyCodeLine{./display\_gp TwoCricles}
\end{DoxyCode}

\end{DoxyEnumerate}

Press \char`\"{}r\char`\"{} to run the algorithm, press \char`\"{}s\char`\"{} to perform a single step and press \char`\"{}q\char`\"{} to stop it.\hypertarget{index_autotoc_md10}{}\doxysection{2. Run in Docker container}\label{index_autotoc_md10}
The code can be compiled and run from inside a docker container. This is advantageous if you do not want to install the above-\/listed dependencies. Keep in mind that the current container image does not support graphical user interface (G\+UI) support which means that the executable display\+\_\+gp cannot be run. \hypertarget{index_autotoc_md11}{}\doxysubsection{Setup Container}\label{index_autotoc_md11}

\begin{DoxyCode}{0}
\DoxyCodeLine{cd /bo\_robotic\_palpation}
\DoxyCodeLine{mkdir build}
\DoxyCodeLine{export BO\_PALPATION\_WS=\$(pwd)}
\end{DoxyCode}



\begin{DoxyCode}{0}
\DoxyCodeLine{sudo docker build -\/f "\$BO\_PALPATION\_WS"/images/Dockerfile -\/t bo\_robotic\_palpation "\$BO\_PALPATION\_WS"}
\end{DoxyCode}
\hypertarget{index_autotoc_md12}{}\doxysubsection{Run Container}\label{index_autotoc_md12}

\begin{DoxyCode}{0}
\DoxyCodeLine{sudo docker run -\/-\/mount type=bind,source="\$BO\_PALPATION\_WS"/data,target=/usr/src/bo\_robotic\_palpation/data -\/-\/mount type=bind,source="\$BO\_PALPATION\_WS"/config,target=/usr/src/bo\_robotic\_palpation/config -\/it -\/t  bo\_robotic\_palpation}
\end{DoxyCode}


Once the prompt opens in the container navigate to the build folder and run the evaluation executable with the desired shape as input. 
\begin{DoxyCode}{0}
\DoxyCodeLine{cd build/}
\DoxyCodeLine{./evaluate YOUR\_DESIRED\_SHAPE}
\end{DoxyCode}
\hypertarget{index_autotoc_md13}{}\doxysubsection{Adjust Parameters}\label{index_autotoc_md13}
Inside the Dockerfile the config directory is mounted which means that parameters can be tuned from the host machine and changes will be carried over into the container. The following parameter files can be adjusted\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{1. config/bo\_parameters.txt  }
\DoxyCodeLine{2. config/contour\_parameters.txt  }
\DoxyCodeLine{3. config/tumor\_model\_parameters.txt}
\end{DoxyCode}


Refer to section 1 for more details on parameter tuning. \hypertarget{index_autotoc_md14}{}\doxysubsection{Visualize Data}\label{index_autotoc_md14}
The results will be written to the host data directory (make sure to not run the following command in the container since visualize.\+py depends on matplotlib which can\textquotesingle{}t be run inside the container in the current version) and can be visualized through\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{cd /scripts/}
\DoxyCodeLine{python3 visualize.py YOUR\_DESIRED\_SHAPE + Number}
\end{DoxyCode}


Example\+: Once a \mbox{\hyperlink{classTriangle}{Triangle}} experiment was evaluated the script can be launched the following way\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{python3 visualize.py Triangle1}
\end{DoxyCode}
 